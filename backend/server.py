from flask import Flask, jsonify, request, send_from_directory
from flask_cors import CORS
import mysql.connector
import os
from deepseek_assistant import DeepSeekAI
import re
from dotenv import load_dotenv

load_dotenv()

app = Flask(__name__, static_folder='../frontend')
CORS(app)

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î
db_config = {
    'host': os.getenv('DB_HOST', 'localhost'),
    'user': os.getenv('DB_USER', 'root'),
    'password': os.getenv('DB_PASSWORD', ''),
    'database': os.getenv('DB_NAME', 'datahub_kz'),
    'port': int(os.getenv('DB_PORT', 3306))
}

print(f"‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ MySQL (–ø–æ—Ä—Ç {db_config['port']})")

def get_db_connection():
    return mysql.connector.connect(**db_config)


# –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è app:
deepseek_ai = DeepSeekAI()

# ==================== –°–¢–ê–¢–ò–ß–ï–°–ö–ò–ï –§–ê–ô–õ–´ ====================
@app.route('/')
def serve_index():
    return send_from_directory('../frontend', 'index.html')

@app.route('/<path:path>')
def serve_static(path):
    return send_from_directory('../frontend', path)

# ==================== API –î–õ–Ø –§–†–û–ù–¢–ï–ù–î–ê ====================
@app.route('/api/universities')
def get_universities():
    conn = get_db_connection()
    cursor = conn.cursor(dictionary=True)
    cursor.execute("""
        SELECT id, name, short_name, city, type, 
               students_count, rating, programs_count,
               ent_min_score, description
        FROM universities 
        ORDER BY rating DESC 
        LIMIT 20
    """)
    universities = cursor.fetchall()
    cursor.close()
    conn.close()
    return jsonify(universities)

@app.route('/api/university/<int:univ_id>')
def get_university(univ_id):
    conn = get_db_connection()
    cursor = conn.cursor(dictionary=True)
    
    # –ü–æ–ª—É—á–∞–µ–º —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç
    cursor.execute("SELECT * FROM universities WHERE id = %s", (univ_id,))
    university = cursor.fetchone()
    
    if not university:
        cursor.close()
        conn.close()
        return jsonify({'error': 'University not found'}), 404
    
    # –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—ã
    cursor.execute("SELECT * FROM programs WHERE university_id = %s", (univ_id,))
    programs = cursor.fetchall()
    university['programs'] = programs
    
    cursor.close()
    conn.close()
    return jsonify(university)

@app.route('/api/universities/search')
def search_universities():
    city = request.args.get('city', '')
    uni_type = request.args.get('type', '')
    
    conn = get_db_connection()
    cursor = conn.cursor(dictionary=True)
    
    sql = """
        SELECT id, name, short_name, city, type, 
               students_count, rating, programs_count
        FROM universities 
        WHERE 1=1
    """
    params = []
    
    if city and city != '–í—Å–µ':
        sql += " AND city = %s"
        params.append(city)
    
    if uni_type and uni_type != '–í—Å–µ':
        sql += " AND type = %s"
        params.append(uni_type)
    
    sql += " ORDER BY rating DESC"
    cursor.execute(sql, params)
    results = cursor.fetchall()
    
    cursor.close()
    conn.close()
    return jsonify(results)

# ==================== –ò–ò-–ê–°–°–ò–°–¢–ï–ù–¢ ====================
@app.route('/api/ai/ask', methods=['POST', 'OPTIONS'])
def ai_assistant():
    """–ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–± —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞—Ö"""
    if request.method == 'OPTIONS':
        return '', 200
    
    try:
        data = request.get_json()
        if not data:
            return jsonify({"success": False, "error": "No data provided"}), 400
        
        question = data.get('question', '').lower()
        
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        conn = get_db_connection()
        cursor = conn.cursor(dictionary=True)
        cursor.execute("""
            SELECT id, name, short_name, city, type, rating, 
                   ent_min_score, students_count, description
            FROM universities 
            ORDER BY rating DESC 
            LIMIT 10
        """)
        universities = cursor.fetchall()
        cursor.close()
        conn.close()
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
        context = "–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –≤ –±–∞–∑–µ:\n"
        for uni in universities:
            context += f"- {uni['name']} ({uni['city']}): "
            context += f"—Ä–µ–π—Ç–∏–Ω–≥ {uni.get('rating', 'N/A')}, "
            context += f"–ï–ù–¢ –æ—Ç {uni.get('ent_min_score', 'N/A')}\n"
        
        # –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
        if "–ø—Ä–∏–≤–µ—Ç" in question or "–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π" in question or "hello" in question:
            answer = "–ü—Ä–∏–≤–µ—Ç! üëã –Ø –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫ DataHub –í–£–ó–æ–≤ –†–ö.\n" \
                    "–ú–æ–≥—É –ø–æ–º–æ—á—å —Å –≤—ã–±–æ—Ä–æ–º —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ!\n\n" \
                    "–°–ø—Ä–æ—Å–∏—Ç–µ –º–µ–Ω—è –æ:\n" \
                    "‚Ä¢ –†–µ–π—Ç–∏–Ω–≥–∞—Ö —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤\n" \
                    "‚Ä¢ –ü—Ä–æ—Ö–æ–¥–Ω—ã—Ö –±–∞–ª–ª–∞—Ö –ï–ù–¢\n" \
                    "‚Ä¢ IT-–ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö\n" \
                    "‚Ä¢ –°—Ä–∞–≤–Ω–µ–Ω–∏–∏ –≤—É–∑–æ–≤\n" \
                    "‚Ä¢ –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö"
        
        elif "–º—É–∏—Ç" in question or "–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π" in question:
            answer = "üéì **–ú–£–ò–¢** - –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–π\n\n" \
                    "üìç **–ì–æ—Ä–æ–¥:** –ê–ª–º–∞—Ç—ã\n" \
                    "‚≠ê **–†–µ–π—Ç–∏–Ω–≥:** 4.6/5\n" \
                    "üéØ **–ú–∏–Ω. –ï–ù–¢:** 105 –±–∞–ª–ª–æ–≤\n" \
                    "üë®‚Äçüéì **–°—Ç—É–¥–µ–Ω—Ç–æ–≤:** 8000\n\n" \
                    "üíª **IT-–ø—Ä–æ–≥—Ä–∞–º–º—ã:**\n" \
                    "‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏\n" \
                    "‚Ä¢ –ö–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å\n" \
                    "‚Ä¢ –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç\n" \
                    "‚Ä¢ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ü–û\n\n" \
                    "üåç **–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–µ:** –ø–∞—Ä—Ç–Ω–µ—Ä—ã –≤ –°–®–ê, –ï–≤—Ä–æ–ø–µ, –ö–æ—Ä–µ–µ"
        
        elif "–∫–±—Ç—É" in question:
            answer = "üéì **–ö–ë–¢–£** - –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω—Å–∫–æ-–ë—Ä–∏—Ç–∞–Ω—Å–∫–∏–π –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç\n\n" \
                    "üìç **–ì–æ—Ä–æ–¥:** –ê–ª–º–∞—Ç—ã\n" \
                    "‚≠ê **–†–µ–π—Ç–∏–Ω–≥:** 4.8/5\n" \
                    "üéØ **–ú–∏–Ω. –ï–ù–¢:** 110 –±–∞–ª–ª–æ–≤\n" \
                    "üë®‚Äçüéì **–°—Ç—É–¥–µ–Ω—Ç–æ–≤:** 11000\n\n" \
                    "üîß **–ü—Ä–æ–≥—Ä–∞–º–º—ã:**\n" \
                    "‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã\n" \
                    "‚Ä¢ –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç\n" \
                    "‚Ä¢ –ö–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å\n" \
                    "‚Ä¢ –ù–µ—Ñ—Ç–µ–≥–∞–∑–æ–≤–æ–µ –¥–µ–ª–æ\n" \
                    "‚Ä¢ Data Science\n\n" \
                    "üá¨üáß **–î–≤–æ–π–Ω—ã–µ –¥–∏–ø–ª–æ–º—ã** —Å –±—Ä–∏—Ç–∞–Ω—Å–∫–∏–º–∏ –≤—É–∑–∞–º–∏"
        
        elif "—Å—Ä–∞–≤–Ω–∏" in question:
            answer = "‚öñÔ∏è **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤:**\n\n" \
                    "| –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç | –†–µ–π—Ç–∏–Ω–≥ | –ì–æ—Ä–æ–¥ | –ú–∏–Ω. –ï–ù–¢ | –°—Ç—É–¥–µ–Ω—Ç–æ–≤ |\n" \
                    "|-------------|---------|--------|----------|------------|\n" \
                    "| –ú–£–ò–¢ | 4.6 | –ê–ª–º–∞—Ç—ã | 105 | 8000 |\n" \
                    "| –ö–ë–¢–£ | 4.8 | –ê–ª–º–∞—Ç—ã | 110 | 11000 |\n" \
                    "| AITU | 4.5 | –ê—Å—Ç–∞–Ω–∞ | 100 | 3500 |\n" \
                    "| –ê–£–≠–° | 4.4 | –ê–ª–º–∞—Ç—ã | 95 | 6000 |\n\n" \
                    "üí° **–í—ã–≤–æ–¥:**\n" \
                    "‚Ä¢ **–î–ª—è IT:** –ú–£–ò–¢ –∏–ª–∏ AITU\n" \
                    "‚Ä¢ **–î–ª—è –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏:** –ö–ë–¢–£\n" \
                    "‚Ä¢ **–ü–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏:** –ê–£–≠–° (–ï–ù–¢ –æ—Ç 95)\n" \
                    "‚Ä¢ **–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É:** –ö–ë–¢–£ (4.8/5)"
        
        elif "–±–∞–ª–ª" in question or "–µ–Ω—Ç" in question:
            # –ò—â–µ–º —Ü–∏—Ñ—Ä—ã –≤ –≤–æ–ø—Ä–æ—Å–µ
            numbers = re.findall(r'\d+', question)
            if numbers:
                score = int(numbers[0])
                answer = f"üéØ **–° –±–∞–ª–ª–æ–º {score} –º–æ–∂–Ω–æ –ø–æ—Å—Ç—É–ø–∏—Ç—å –≤:**\n\n"
                
                if score >= 110:
                    answer += "‚úÖ **–ö–ë–¢–£** - –≤—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã\n"
                if score >= 105:
                    answer += "‚úÖ **–ú–£–ò–¢** - IT –ø—Ä–æ–≥—Ä–∞–º–º—ã\n"
                if score >= 100:
                    answer += "‚úÖ **AITU** - Data Science, IT\n"
                if score >= 95:
                    answer += "‚úÖ **–ê–£–≠–°** - —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞, —Å–≤—è–∑—å\n"
                if score < 95:
                    answer += "üìö **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –∏–ª–∏ –∫–æ–ª–ª–µ–¥–∂–∏\n"
                answer += "\nüí° *–¢–æ—á–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—ã*"
            else:
                answer = "üéì **–ü—Ä–æ—Ö–æ–¥–Ω—ã–µ –±–∞–ª–ª—ã –ï–ù–¢ (–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ):**\n\n" \
                        "‚Ä¢ **–ö–ë–¢–£:** –æ—Ç 110 –±–∞–ª–ª–æ–≤\n" \
                        "‚Ä¢ **–ú–£–ò–¢:** –æ—Ç 105 –±–∞–ª–ª–æ–≤\n" \
                        "‚Ä¢ **AITU:** –æ—Ç 100 –±–∞–ª–ª–æ–≤\n" \
                        "‚Ä¢ **–ê–£–≠–°:** –æ—Ç 95 –±–∞–ª–ª–æ–≤\n\n" \
                        "üîç **–£—Ç–æ—á–Ω–∏—Ç–µ –≤–∞—à –±–∞–ª–ª** –¥–ª—è —Ç–æ—á–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π!"
        
        elif "it" in question or "–∞–π—Ç–∏" in question or "–∫–æ–º–ø—å—é—Ç–µ—Ä" in question:
            answer = "üíª **IT-—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞:**\n\n" \
                    "1. **–ú–£–ò–¢** (–ê–ª–º–∞—Ç—ã) - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π IT-–≤—É–∑\n" \
                    "   ‚≠ê 4.6 | üéØ –ï–ù–¢ 105+ | üíª –°–∏–ª—å–Ω—ã–µ IT –ø—Ä–æ–≥—Ä–∞–º–º—ã\n\n" \
                    "2. **AITU** (–ê—Å—Ç–∞–Ω–∞) - –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π IT-—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç\n" \
                    "   ‚≠ê 4.5 | üéØ –ï–ù–¢ 100+ | üèõÔ∏è –§–æ–∫—É—Å –Ω–∞ —Ü–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏—é\n\n" \
                    "3. **–ö–ë–¢–£** (–ê–ª–º–∞—Ç—ã) - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å —Å–∏–ª—å–Ω—ã–º–∏ IT-–ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏\n" \
                    "   ‚≠ê 4.8 | üéØ –ï–ù–¢ 110+ | üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –±–∞–∑–∞\n\n" \
                    "4. **–ö–∞–∑–ù–£** (–ê–ª–º–∞—Ç—ã) - –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ –Ω–∞—É–∫–∏\n" \
                    "   ‚≠ê 4.7 | üéØ –ï–ù–¢ 108+ | üéì –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ\n\n" \
                    "üî• **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ IT-–ø—Ä–æ–≥—Ä–∞–º–º—ã:**\n" \
                    "‚Ä¢ Data Science\n‚Ä¢ –ö–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å\n‚Ä¢ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ü–û\n‚Ä¢ –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç\n‚Ä¢ –í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞"
        
        elif "–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω" in question or "–∑–∞—Ä—É–±–µ–∂" in question or "–ø–∞—Ä—Ç–Ω–µ—Ä" in question:
            answer = "üåç **–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–µ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ:**\n\n" \
                    "**–ö–ë–¢–£:**\n" \
                    "‚Ä¢ –ü–∞—Ä—Ç–Ω–µ—Ä—ã: MIT (–°–®–ê), Oxford (UK), TU Berlin (–ì–µ—Ä–º–∞–Ω–∏—è)\n" \
                    "‚Ä¢ –ü—Ä–æ–≥—Ä–∞–º–º—ã –¥–≤–æ–π–Ω—ã—Ö –¥–∏–ø–ª–æ–º–æ–≤\n\n" \
                    "**–ú–£–ò–¢:**\n" \
                    "‚Ä¢ –û–±–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Å –ï–≤—Ä–æ–ø–æ–π –∏ –ê–∑–∏–µ–π\n" \
                    "‚Ä¢ –ü–∞—Ä—Ç–Ω–µ—Ä—ã –≤ –ö–æ—Ä–µ–µ, –Ø–ø–æ–Ω–∏–∏, –°–®–ê\n\n" \
                    "**AITU:**\n" \
                    "‚Ä¢ –°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ —Å IT-–∫–æ–º–ø–∞–Ω–∏—è–º–∏ –º–∏—Ä–∞\n" \
                    "‚Ä¢ –°—Ç–∞–∂–∏—Ä–æ–≤–∫–∏ –∑–∞ —Ä—É–±–µ–∂–æ–º\n\n" \
                    "**–ù–ê–û:**\n" \
                    "‚Ä¢ –ü—Ä–æ–≥—Ä–∞–º–º—ã –¥–≤–æ–π–Ω—ã—Ö –¥–∏–ø–ª–æ–º–æ–≤ —Å –ï–°\n" \
                    "‚Ä¢ –ì—Ä–∞–Ω—Ç—ã –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ –∑–∞ –≥—Ä–∞–Ω–∏—Ü–µ–π\n\n" \
                    "‚úàÔ∏è **–ü—Ä–æ–≥—Ä–∞–º–º—ã –æ–±–º–µ–Ω–∞:**\n" \
                    "‚Ä¢ Erasmus+ (–ï–≤—Ä–æ–ø–∞)\n‚Ä¢ Campus France (–§—Ä–∞–Ω—Ü–∏—è)\n‚Ä¢ DAAD (–ì–µ—Ä–º–∞–Ω–∏—è)\n‚Ä¢ Global Korea (–ö–æ—Ä–µ—è)"
        
        elif "—Ä–µ–π—Ç–∏–Ω–≥" in question or "—Ç–æ–ø" in question or "–ª—É—á—à–∏–π" in question:
            answer = "üèÜ **–¢–æ–ø —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É:**\n\n"
            for i, uni in enumerate(universities[:5], 1):
                answer += f"{i}. **{uni['name']}** ({uni['short_name']})\n"
                answer += f"   ‚≠ê {uni['rating']}/5 | üìç {uni['city']}\n"
                answer += f"   üéØ –ï–ù–¢ –æ—Ç {uni.get('ent_min_score', 'N/A')} | üë®‚Äçüéì {uni.get('students_count', 'N/A')} —Å—Ç—É–¥–µ–Ω—Ç–æ–≤\n\n"
            answer += "üìä *–†–µ–π—Ç–∏–Ω–≥ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è, –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö –∏ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤*"
        
        elif "–ø—Ä–æ–≥—Ä–∞–º–º" in question or "—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å" in question:
            answer = "üéì **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –æ–±—É—á–µ–Ω–∏—è:**\n\n" \
                    "**IT-–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**\n" \
                    "‚Ä¢ Computer Science\n‚Ä¢ Data Science\n‚Ä¢ –ö–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å\n‚Ä¢ –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç\n\n" \
                    "**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ:**\n" \
                    "‚Ä¢ –ò–Ω–∂–µ–Ω–µ—Ä–∏—è\n‚Ä¢ –ù–µ—Ñ—Ç–µ–≥–∞–∑–æ–≤–æ–µ –¥–µ–ª–æ\n‚Ä¢ –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞\n‚Ä¢ –¢–µ–ª–µ–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏\n\n" \
                    "**–ë–∏–∑–Ω–µ—Å:**\n" \
                    "‚Ä¢ –ú–µ–Ω–µ–¥–∂–º–µ–Ω—Ç\n‚Ä¢ –§–∏–Ω–∞–Ω—Å—ã\n‚Ä¢ –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥\n‚Ä¢ –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è\n\n" \
                    "üí° *–î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º —É—Ç–æ—á–Ω–∏—Ç–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç*"
        
        else:
            answer = f"ü§ñ –Ø –ø–æ–ª—É—á–∏–ª –≤–∞—à –≤–æ–ø—Ä–æ—Å: '{data.get('question', '')}'\n\n" \
                    "–Ø –º–æ–≥—É –ø–æ–º–æ—á—å —Å:\n" \
                    "üéØ **–ü–æ–¥–±–æ—Ä–æ–º –ø–æ –±–∞–ª–ª–∞–º –ï–ù–¢**\n" \
                    "‚öñÔ∏è **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ–º —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤**\n" \
                    "üíª **IT-–ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏**\n" \
                    "üåç **–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏**\n" \
                    "üèÜ **–†–µ–π—Ç–∏–Ω–≥–∞–º–∏ –≤—É–∑–æ–≤**\n" \
                    "üéì **–ü—Ä–æ–≥—Ä–∞–º–º–∞–º–∏ –æ–±—É—á–µ–Ω–∏—è**\n\n" \
                    "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–¥–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –ù–∞–ø—Ä–∏–º–µ—Ä:\n" \
                    "‚Ä¢ '–°—Ä–∞–≤–Ω–∏ –ú–£–ò–¢ –∏ –ö–ë–¢–£'\n" \
                    "‚Ä¢ '–ö—É–¥–∞ –ø–æ—Å—Ç—É–ø–∏—Ç—å —Å 105 –±–∞–ª–ª–∞–º–∏?'\n" \
                    "‚Ä¢ '–ö–∞–∫–∏–µ IT-–≤—É–∑—ã –≤ –ê–ª–º–∞—Ç—ã?'"
        
        return jsonify({
            "success": True,
            "answer": answer,
            "question": data.get('question', ''),
            "context": f"–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ {len(universities)} —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤"
        })
        
    except Exception as e:
        return jsonify({
            "success": False,
            "error": str(e),
            "answer": "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑."
        }), 500

# ==================== –ó–ê–ü–£–°–ö –°–ï–†–í–ï–†–ê ====================
if __name__ == '__main__':
    print("\n" + "="*50)
    print("üöÄ DataHub –í–£–ó–æ–≤ –†–ö - –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω!")
    print("="*50)
    print("üåê –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: http://localhost:8000")
    print("üì° API —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤: http://localhost:8000/api/universities")
    print("ü§ñ –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç: POST http://localhost:8000/api/ai/ask")
    print("="*50 + "\n")
    app.run(debug=True, port=5000)