<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞</title>

<style>
body {
    margin: 0;
    font-family: Segoe UI, sans-serif;
    background: #f5f7ff;
}

/* üîµ –í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫ */
.search-header {
    background: linear-gradient(135deg, #1e5bff, #8b3dff);
    color: white;
    padding: 50px 50px 70px;
    border-radius: 0 0 25px 25px;
}

.search-title {
    font-size: 36px;
    font-weight: bold;
}

.search-sub {
    font-size: 18px;
    opacity: 0.9;
    margin-top: 5px;
}

.search-box-uni {
    margin-top: 25px;
    background: white;
    display: flex;
    align-items: center;
    padding: 14px 20px;
    max-width: 450px;
    border-radius: 40px;
}

.search-box-uni input {
    border: none;
    flex: 1;
    font-size: 17px;
    outline: none;
}

.search-icon {
    margin-right: 10px;
    font-size: 20px;
}

/* üìå –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.container {
    display: flex;
    padding: 40px;
}

/* üü£ –§–∏–ª—å—Ç—Ä—ã */
.filters {
    width: 250px;
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-right: 30px;
}

.filters input {
    margin-right: 7px;
}

.ftitle {
    margin-top: 20px;
    font-weight: 600;
}

/* üìå –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã */
.cards {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 25px;
    width: 100%;
}

.university-card {
    background: white;
    padding: 20px;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    animation: fade-in 0.6s ease;
}

.uni-img {
    width: 100%;
    height: 220px;
    object-fit: cover;
    border-radius: 15px;
}

.badge {
    padding: 5px 12px;
    display: inline-block;
    border-radius: 20px;
    margin-top: 10px;
    color: white;
    font-size: 13px;
}

.private { background: #8250ff; }
.state   { background: #1e90ff; }

.btn {
    width: 100%;
    padding: 14px;
    font-size: 17px;
    border: none;
    color: white;
    margin-top: 15px;
    background: linear-gradient(90deg, #1e5bff, #8b3dff);
    border-radius: 12px;
    cursor: pointer;
}

.meta {
    margin: 10px 0;
    color: #555;
    font-size: 15px;
}

#loading {
    text-align: center;
    padding: 40px;
    font-size: 18px;
    color: #666;
    grid-column: 1 / -1;
}

@keyframes fade-in {
    from { opacity: 0; transform: translateY(10px); }
    to   { opacity: 1; transform: translateY(0); }
}
</style>
</head>

<body>

<!-- üîµ –í–µ—Ä—Ö–Ω–∏–π –ø–æ–∏—Å–∫ -->
<div class="search-header">
    <div class="search-title">–ü–æ–∏—Å–∫ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤</div>
    <div class="search-sub">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞ –∏–ª–∏ –≥–æ—Ä–æ–¥.</div>

    <div class="search-box-uni">
        <span class="search-icon">üîé</span>
        <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫...">
    </div>
</div>

<!-- üü£ –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å -->
<div class="container">

    <!-- –§–ò–õ–¨–¢–†–´ -->
    <div class="filters">
        <h3>–§–∏–ª—å—Ç—Ä—ã</h3>

        <p class="ftitle">–¢–∏–ø —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞</p>
        <label><input type="radio" name="type" value="all" checked> –í—Å–µ</label><br>
        <label><input type="radio" name="type" value="state"> –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π</label><br>
        <label><input type="radio" name="type" value="private"> –ß–∞—Å—Ç–Ω—ã–π</label><br>

        <p class="ftitle">–ì–æ—Ä–æ–¥</p>
        <label><input type="radio" name="city" value="all" checked> –í—Å–µ</label><br>
        <label><input type="radio" name="city" value="–∞–ª–º–∞—Ç—ã"> –ê–ª–º–∞—Ç—ã</label><br>
        <label><input type="radio" name="city" value="–∞—Å—Ç–∞–Ω–∞"> –ê—Å—Ç–∞–Ω–∞</label>
    </div>

    <!-- –ö–ê–†–¢–û–ß–ö–ò –í–£–ó–û–í (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ) -->
    <div class="cards" id="universityList">
        <div id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤...</div>
    </div>
</div>

<!-- üî• JavaScript –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã -->
<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞
function getImageForUniversity(uni) {
    const name = (uni.short_name || uni.name).toLowerCase();
    
    // –ú–∞–ø–ø–∏–Ω–≥ –Ω–∞–∑–≤–∞–Ω–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤ –Ω–∞ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤
    const imageMap = {
        // –ö–ë–¢–£
        '–∫–±—Ç': 'kbtu.jpg',
        'kbt': 'kbtu.jpg',
        '–∫–∞–∑–∞—Ö—Å—Ç–∞–Ω—Å–∫–æ-–±—Ä–∏—Ç–∞–Ω—Å–∫–∏–π': 'kbtu.jpg',
        
        // AITU
        'aitu': 'aitu.jpg',
        'astana it': 'aitu.jpg',
        '–∞—Å—Ç–∞–Ω–∞ it': 'aitu.jpg',
        '–∞–∏—Ç—É': 'aitu.jpg',
        
        // –ú–£–ò–¢
        '–º—É–∏—Ç': 'muit.jpg',
        '–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π': 'muit.jpg',
        
        // –ê–£–≠–°
        '–∞—É—ç—Å': 'aues.jpg',
        'aues': 'aues.jpg',
        '–∞–ª–º–∞—Ç–∏–Ω—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∏ –∏ —Å–≤—è–∑–∏': 'aues.jpg'
    };
    
    // –ò—â–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
    for (const [keyword, filename] of Object.entries(imageMap)) {
        if (name.includes(keyword)) {
            return `images/${filename}`;
        }
    }
    
    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    return 'images/default.jpg'; // (–≤–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å default.jpg)
}

// –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
async function loadUniversities() {
    try {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        document.getElementById('loading').textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...';
        
        // –ó–∞–ø—Ä–æ—Å –∫ API
        const response = await fetch('http://localhost:5000/api/universities');
        
        if (!response.ok) {
            throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
        }
        
        const universities = await response.json();
        
        // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ
        document.getElementById('loading').style.display = 'none';
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã
        displayUniversities(universities);
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
        setupFilters();
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
        document.getElementById('loading').innerHTML = 
            '<div style="color: red; text-align: center; padding: 40px;">' +
            '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:<br>' +
            '1. –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (python server.py)<br>' +
            '2. API –¥–æ—Å—Ç—É–ø–Ω–æ: http://localhost:5000/api/universities<br>' +
            '<button onclick="location.reload()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>' +
            '</div>';
    }
}

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤
function displayUniversities(universities) {
    const container = document.getElementById('universityList');
    
    if (!universities || universities.length === 0) {
        container.innerHTML = '<p style="text-align: center; grid-column: 1 / -1;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞—Ö</p>';
        return;
    }
    
    let html = '';
    
    universities.forEach(uni => {
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∏ —Ü–≤–µ—Ç –±–µ–π–¥–∂–∞
        const isPrivate = uni.type === '–ß–∞—Å—Ç–Ω—ã–π';
        const typeClass = isPrivate ? 'private' : 'state';
        const typeText = isPrivate ? '–ß–∞—Å—Ç–Ω—ã–π' : '–ì–æ—Å.';
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≥–æ—Ä–æ–¥ (–ø–µ—Ä–≤–∞—è –±—É–∫–≤–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è)
        const city = uni.city ? (uni.city.charAt(0).toUpperCase() + uni.city.slice(1)) : '–ù–µ —É–∫–∞–∑–∞–Ω';
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
        const students = uni.students_count ? 
            uni.students_count.toLocaleString() + '+' : 
            '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
        
        // –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
        const imageUrl = getImageForUniversity(uni);
        
        html += `
        <div class="university-card" 
            data-name="${uni.name.toLowerCase()}"
            data-short="${(uni.short_name || '').toLowerCase()}"
            data-city="${(uni.city || '').toLowerCase()}"
            data-type="${isPrivate ? 'private' : 'state'}">

            <img src="${imageUrl}" 
                 class="uni-img" 
                 alt="${uni.name}"
                 onerror="this.src='images/default.jpg'">

            <div class="badge ${typeClass}">${typeText}</div>

            <h2>${uni.short_name ? uni.short_name + ' ‚Äî ' : ''}${uni.name}</h2>
            <p>${city} ‚Ä¢ ${students} —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>

            <div class="meta">‚≠ê ${uni.rating ? uni.rating.toFixed(1) : '0.0'} —Ä–µ–π—Ç–∏–Ω–≥ | üéì ${uni.programs_count || '0'}+ –ø—Ä–æ–≥—Ä–∞–º–º</div>

            <button class="btn" onclick="viewUniversity(${uni.id})">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
        </div>
        `;
    });
    
    container.innerHTML = html;
}

// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞
function viewUniversity(univId) {
    window.location.href = `university.html?id=${univId}`;
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
function setupFilters() {
    const searchInput = document.getElementById("searchInput");
    const typeFilters = document.querySelectorAll("input[name='type']");
    const cityFilters = document.querySelectorAll("input[name='city']");
    
    function updateFilter() {
        const query = searchInput.value.toLowerCase();
        const selectedType = document.querySelector("input[name='type']:checked").value;
        const selectedCity = document.querySelector("input[name='city']:checked").value;
        
        const cards = document.querySelectorAll(".university-card");
        
        cards.forEach(card => {
            const name = card.dataset.name || '';
            const short = card.dataset.short || '';
            const city = card.dataset.city || '';
            const type = card.dataset.type || '';
            
            let show = true;
            
            // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∫–æ—Ä–æ—Ç–∫–æ–º—É –∏–º–µ–Ω–∏
            if (query && !name.includes(query) && !short.includes(query)) {
                show = false;
            }
            
            // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É
            if (selectedType !== "all" && selectedType !== type) {
                show = false;
            }
            
            // –§–∏–ª—å—Ç—Ä –ø–æ –≥–æ—Ä–æ–¥—É
            if (selectedCity !== "all" && selectedCity !== city) {
                show = false;
            }
            
            card.style.display = show ? "block" : "none";
        });
    }
    
    // –°–æ–±—ã—Ç–∏—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
    searchInput.addEventListener("input", updateFilter);
    typeFilters.forEach(el => el.addEventListener("change", updateFilter));
    cityFilters.forEach(el => el.addEventListener("change", updateFilter));
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', loadUniversities);

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API
function testAPI() {
    console.log('–¢–µ—Å—Ç–∏—Ä—É–µ–º API...');
    fetch('http://localhost:5000/api/universities')
        .then(r => {
            console.log('–°—Ç–∞—Ç—É—Å:', r.status);
            return r.json();
        })
        .then(data => {
            console.log('–ü–æ–ª—É—á–µ–Ω–æ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤:', data.length);
            console.log('–ü–µ—Ä–≤—ã–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç:', data[0]);
        })
        .catch(e => console.error('–¢–µ—Å—Ç –Ω–µ –ø—Ä–æ–π–¥–µ–Ω:', e));
}


</script>

</body>
</html>